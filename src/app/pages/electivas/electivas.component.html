<div id="container" class="sm:flex">
  @if (recomendacionPantalla && anchoDelDisplay <= 768) {
    <div id="recomendacion-pantalla" class="mb-5 flex" role="group" (click)="cerrarRecomendacion()">
      <button type="button" class="rounded-l bg-gray-600 px-4 py-2 text-left text-white">
        Para una mejor experiencia, te recomendamos visualizar la p√°gina en tablet panor√°mica o PC
      </button>
      <button type="button" class="rounded-r bg-gray-600 px-3 py-2 text-white">
        <i class="fas fa-lg fa-times"></i>
      </button>
    </div>
  }

  <!-- Estructura superior -->
  <div class="rounded-none border border-gray-200 bg-white">
    <div class="flex flex-wrap">
      <div class="order-1 hidden w-full lg:block lg:w-3/12 xl:w-3/12">
        <div class="w-full">
          <div
            id="icono-carrera"
            class="mx-auto flex items-center justify-center"
            [ngClass]="estilosDeCarrera(carreraElegida.id)"
          >
            <i class="fas fa-5x" [ngClass]="carreraElegida.iconClass"></i>
          </div>
        </div>

        @if (anchoDelDisplay >= 768) {
          <ng-container *ngTemplateOutlet="calculadora"> </ng-container>
        }
      </div>
      <div class="order-2 w-full md:order-1 md:w-7/12 lg:order-2 lg:w-5/12 xl:w-6/12">
        <div class="md:block">
          <ng-container *ngTemplateOutlet="filtroCuatrimestres"> </ng-container>
        </div>

        <ng-container *ngTemplateOutlet="cuerpo"> </ng-container>

        @if (anchoDelDisplay < 768) {
          <ng-container *ngTemplateOutlet="calculadora"> </ng-container>
          <ng-container *ngTemplateOutlet="redesSociales"> </ng-container>
        }
      </div>
      <div class="order-1 w-full md:order-2 md:w-5/12 lg:order-3 lg:w-4/12 xl:w-3/12">
        <div class="w-full text-center">
          @if (carreraElegida.id !== 'basicas') {
            <button
              id="icono-calculadora"
              class="block justify-center bg-gray-800 p-1 text-white md:hidden"
              (click)="toggleCalculadora()"
            >
              <i class="fas fa-2x fa-calculator"></i>
            </button>
          }

          <ng-container *ngTemplateOutlet="dropdownCarrera"> </ng-container>

          <button
            id="icono-ayuda"
            class="block justify-center bg-blue-400 p-1 text-white md:hidden"
            (click)="toggleAyuda()"
          >
            <i class="fas fa-2x fa-question-circle"></i>
          </button>

          @if (anchoDelDisplay >= 768) {
            <ng-container *ngTemplateOutlet="redesSociales"> </ng-container>
          }

          @if (anchoDelDisplay < 992 && anchoDelDisplay >= 768) {
            <ng-container *ngTemplateOutlet="calculadora"> </ng-container>
          }
        </div>
      </div>
    </div>

    <div class="flex min-h-[calc(100vh-550px)] flex-col pt-0">
      <!-- Header de la lista de tarjetas -->
      <div class="mb-2 hidden flex-wrap bg-gray-100 px-2 sm:flex">
        <div class="w-3/12 md:w-2/12 lg:w-2/12">&nbsp;</div>
        <div class="w-4/12 md:w-4/12 lg:w-5/12"><b>Nombre</b></div>
        <div class="hidden w-2/12 text-center md:flex lg:w-2/12">
          <b>Cr√©ditos</b>
        </div>
        <div class="w-5/12 text-center md:w-4/12 md:text-left lg:w-3/12">
          <b>Horarios</b>
        </div>
      </div>

      @if (cargando) {
        <app-loading-spinner mensaje="Cargando electivas..."></app-loading-spinner>
      }

      <!-- Lista de tarjetas -->
      @for (electiva of electivasFiltradas; track electiva; let i = $index) {
        <div class="mb-2 rounded-none border border-gray-200 shadow-sm">
          <div class="flex flex-wrap">
            <!-- Bot√≥n desplegable y marcador de estado -->
            <div class="flex w-4/12 flex-col items-center justify-center sm:w-3/12 md:w-2/12 lg:w-2/12">
              @if (carreraElegida.id !== 'basicas') {
                <div class="relative inline-flex">
                  <button
                    type="button"
                    class="rounded-l px-3 py-1 font-bold"
                    [ngClass]="estilosDeElectiva(carreraElegida.id, electiva)"
                    (click)="cambiarVista(electiva)"
                  >
                    <i
                      class="fas"
                      [ngClass]="{
                        'fa-plus': !electiva.vistaCompleta,
                        'fa-minus': electiva.vistaCompleta,
                      }"
                    ></i>
                  </button>
                  <button
                    class="rounded-r border-l border-white/30 px-2 py-1"
                    [ngClass]="estilosDeElectiva(carreraElegida.id, electiva)"
                    (click)="toggleElectivaDropdown(i, $event)"
                  >
                    ‚ñº
                  </button>
                  @if (electivaDropdownIndex === i) {
                    <div
                      class="absolute top-full left-0 z-50 min-w-40 rounded border border-gray-200 bg-white shadow-lg"
                    >
                      <div class="flex w-full">
                        <span class="w-8 rounded-none bg-gray-100">&nbsp;</span>
                        <button class="grow px-3 py-1 text-left hover:bg-gray-100" (click)="limpiarEstado(electiva)">
                          Limpiar
                        </button>
                      </div>
                      <div class="flex w-full">
                        <span class="w-8 rounded-none bg-blue-600">&nbsp;</span>
                        <button class="grow px-3 py-1 text-left hover:bg-gray-100" (click)="marcarCursada(electiva)">
                          Cursada
                        </button>
                      </div>
                      <div class="flex w-full">
                        <span class="w-8 rounded-none bg-green-600">&nbsp;</span>
                        <button class="grow px-3 py-1 text-left hover:bg-gray-100" (click)="marcarAprobada(electiva)">
                          Aprobada
                        </button>
                      </div>
                    </div>
                  }
                </div>
              }
              @if (carreraElegida.id === 'basicas') {
                <button
                  type="button"
                  class="rounded px-3 py-1 font-bold"
                  [ngClass]="estilosDeElectiva(carreraElegida.id, electiva)"
                  (click)="cambiarVista(electiva)"
                >
                  <i
                    class="fas"
                    [ngClass]="{
                      'fa-plus': !electiva.vistaCompleta,
                      'fa-minus': electiva.vistaCompleta,
                    }"
                  ></i>
                </button>
              }
              <h5 class="mb-0 mt-2 font-normal text-gray-500 md:hidden">{{ electiva.creditos }} horas</h5>
            </div>
            <!-- Nombre -->
            <div class="flex w-8/12 flex-col items-start justify-center sm:w-4/12 md:w-5/12 lg:w-5/12">
              <h5 class="font-normal md:hidden">{{ electiva.nombre }}</h5>
              <h5 class="hidden md:block">{{ electiva.nombre }}</h5>
              <div class="mt-2 text-sm sm:hidden">
                @for (horario of electiva.horarios; track horario) {
                  <p class="mb-1 me-2">{{ horario }}</p>
                }
              </div>
            </div>
            <!-- Cr√©ditos -->
            <div class="hidden w-2/12 items-center justify-start md:flex">
              <p class="mb-1">{{ electiva.creditos }} horas</p>
            </div>
            <!-- Horarios -->
            <div
              class="hidden w-5/12 items-center justify-end pe-2 sm:flex sm:w-5/12 md:w-3/12 md:justify-start md:pe-0 lg:w-3/12"
            >
              <div class="hidden text-sm sm:block">
                @for (horario of electiva.horarios; track horario) {
                  <p class="mb-1">{{ horario }}</p>
                }
              </div>
            </div>
          </div>
          @if (electiva.vistaCompleta) {
            <hr class="my-1" />
            <div class="flex flex-wrap">
              <div class="w-6/12 pe-1 ps-3 md:w-3/12 md:pe-0 lg:ps-3 xl:w-2/12 xl:ps-4">
                @if (electiva.docentes && electiva.docentes.length) {
                  <div class="mb-2">
                    <p class="mb-1"><b>Docentes:</b></p>
                    @for (docente of electiva.docentes; track docente) {
                      <p class="mb-1">{{ docente }}</p>
                    }
                  </div>
                }
                @if (electiva.nivel || electiva.cuatrimestre) {
                  <div class="mb-2">
                    <p class="mb-1"><b>Se dicta en:</b></p>
                    <p class="mb-1">{{ electiva.nivel }}¬∞ Nivel</p>
                    <p class="mb-1">{{ electiva.cuatrimestre }}</p>
                  </div>
                }
                @if (electiva.area) {
                  <div class="mb-2 block md:hidden">
                    <p class="mb-1"><b>√Årea:</b></p>
                    <p class="text-justify">{{ electiva.area }}</p>
                  </div>
                }
                @if (electiva.tipoDeAprobacion) {
                  <div class="mb-2">
                    <p class="mb-1"><b>Tipo de Aprobaci√≥n:</b></p>
                    <p class="mb-1">{{ electiva.tipoDeAprobacion }}</p>
                  </div>
                }
                @if (electiva.actividades && electiva.actividades.length) {
                  <div class="mb-2 block md:hidden">
                    <p class="mb-1"><b>Instancias de Evaluaci√≥n:</b></p>
                    <p class="text-justify">{{ electiva.actividades }}</p>
                  </div>
                }
              </div>
              <div class="w-6/12 ps-1 pe-2 md:w-4/12 md:ps-0 md:pe-0 xl:w-5/12">
                @if (electiva.cursadasParaCursar && electiva.cursadasParaCursar.length) {
                  <p class="mb-1"><b>Cursadas para Cursar:</b></p>
                  @for (correlativa of electiva.cursadasParaCursar; track correlativa) {
                    <p class="mb-1">{{ correlativa }}</p>
                  }
                }
                @if (electiva.aprobadasParaCursar && electiva.aprobadasParaCursar.length) {
                  <p class="mb-1"><b>Aprobadas para Cursar:</b></p>
                  @for (correlativa of electiva.aprobadasParaCursar; track correlativa) {
                    <p class="mb-1">{{ correlativa }}</p>
                  }
                }
                @if (electiva.aprobadasParaRendir && electiva.aprobadasParaRendir.length) {
                  <p class="mb-1"><b>Aprobadas para Rendir:</b></p>
                  @for (correlativa of electiva.aprobadasParaRendir; track correlativa) {
                    <p class="mb-1">{{ correlativa }}</p>
                  }
                }
              </div>
              <div class="w-full px-2 md:w-5/12 lg:pe-3 xl:w-5/12 xl:pe-4">
                @if (electiva.area) {
                  <div class="hidden md:block">
                    <p class="mb-1"><b>√Årea:</b></p>
                    <p class="text-justify">{{ electiva.area }}</p>
                  </div>
                }
                @if (electiva.actividades && electiva.actividades.length) {
                  <div class="hidden md:block">
                    <p class="mb-1"><b>Instancias de Evaluaci√≥n:</b></p>
                    <p class="text-justify">{{ electiva.actividades }}</p>
                  </div>
                }
                @if (electiva.comentarios && electiva.comentarios.length) {
                  <hr class="my-1 md:hidden" />
                  <p class="mb-1"><b>Comentarios de Estudiantes:</b></p>
                  @for (comentario of electiva.comentarios; track comentario) {
                    <p class="mb-1 text-justify">{{ comentario }}</p>
                  }
                }
              </div>
            </div>
          }
        </div>
      }
    </div>
  </div>
</div>

<ng-template #calculadora>
  @if (calculadoraVisible && carreraElegida.id !== 'basicas') {
    <div class="m-3 rounded-none border border-gray-200 bg-white p-2 shadow md:mx-4 lg:ms-3">
      <div class="flex">
        <div class="flex-1">
          <p class="mb-0">
            <span class="w-full rounded bg-blue-600 p-1 text-sm font-normal text-white">Cursadas</span>
          </p>
        </div>
        <div class="flex-1 text-center">{{ contadorCursadas }} / {{ carreraElegida.horasTotales }}</div>
        <div class="flex-1 text-center">
          @if (contadorCursadas > 0) {
            {{ ((contadorCursadas / carreraElegida.horasTotales) * 100).toFixed(2) }}%
          }
          @if (contadorCursadas === 0) {
            0%
          }
        </div>
      </div>
      <div class="flex">
        <div class="flex-1">
          <p class="mb-0">
            <span class="w-full rounded bg-green-600 p-1 text-sm font-normal text-white">Aprobadas</span>
          </p>
        </div>
        <div class="flex-1 text-center">{{ contadorAprobadas }} / {{ carreraElegida.horasTotales }}</div>
        <div class="flex-1 text-center">
          @if (contadorAprobadas > 0) {
            {{ ((contadorAprobadas / carreraElegida.horasTotales) * 100).toFixed(2) }}%
          }
          @if (contadorAprobadas === 0) {
            0%
          }
        </div>
      </div>
      <hr class="my-1" />
      <p class="mb-0 text-justify text-xs text-gray-500">
        @if (contadorAprobadas === 0) {
          Para calcular, pod√©s marcar materias como cursadas o aprobadas marcando en el bot√≥n ‚ñº a la izquierda de cada
          electiva
        }
        @if (contadorAprobadas > 0 && contadorAprobadas < carreraElegida.horasTotales) {
          ¬°Est√°s a solamente {{ carreraElegida.horasTotales - contadorAprobadas }}
          horas de cumplir con el cupo! ¬°A darle √°tomos!
        }
        @if (contadorAprobadas >= carreraElegida.horasTotales) {
          ¬°Felicitaciones! Ya cumpliste con el cupo de horas de electivas. ¬°Que venga r√°pido ese t√≠tulo!
        }
      </p>
    </div>
  }

  @if (carreraElegida.id === 'basicas' || contadorAprobadas === 0) {
    <div class="mt-3 mb-3 hidden rounded-none border border-gray-200 bg-white p-2 shadow md:mx-4 lg:block lg:ms-3">
      <p class="mb-1 text-justify text-xs text-gray-500">
        <b>Cita recomendada:</b>
      </p>
      <p class="mb-0 text-justify text-xs text-gray-500">
        {{ fraseSeleccionada }}
      </p>
    </div>
  }
</ng-template>

<ng-template #filtroCuatrimestres>
  <div class="p-2 text-center">Filtr√° las electivas seg√∫n cu√°ndo se dictan:</div>

  <div id="filtro-cuatrimestres" class="mx-auto mt-2 mb-2 rounded bg-gray-200 p-2 shadow md:mb-0">
    <span class="ms-2 me-3 hidden font-bold xl:inline">Filtro:</span>

    <div class="inline-flex overflow-hidden rounded border border-gray-400">
      <label
        class="cursor-pointer border-r border-gray-400 px-3 py-1 text-sm"
        [class.bg-gray-300]="filtroCuatrimestre.anual"
      >
        <input
          type="checkbox"
          class="hidden"
          [(ngModel)]="filtroCuatrimestre.anual"
          (ngModelChange)="filtrarPorCuatrimestre(filtroCuatrimestre)"
        />
        @if (filtroCuatrimestre.anual) {
          ‚úîÔ∏è
        } @else {
          ‚ùå
        }
        Anual
      </label>
      <label
        class="cursor-pointer border-r border-gray-400 px-3 py-1 text-sm"
        [class.bg-gray-300]="filtroCuatrimestre.primero"
      >
        <input
          type="checkbox"
          class="hidden"
          [(ngModel)]="filtroCuatrimestre.primero"
          (ngModelChange)="filtrarPorCuatrimestre(filtroCuatrimestre)"
        />
        @if (filtroCuatrimestre.primero) {
          ‚úîÔ∏è
        } @else {
          ‚ùå
        }
        1er Cuatrimestre
      </label>
      <label class="cursor-pointer px-3 py-1 text-sm" [class.bg-gray-300]="filtroCuatrimestre.segundo">
        <input
          type="checkbox"
          class="hidden"
          [(ngModel)]="filtroCuatrimestre.segundo"
          (ngModelChange)="filtrarPorCuatrimestre(filtroCuatrimestre)"
        />
        @if (filtroCuatrimestre.segundo) {
          ‚úîÔ∏è
        } @else {
          ‚ùå
        }
        2do Cuatrimestre
      </label>
    </div>
  </div>
</ng-template>

<ng-template #cuerpo>
  @if (bienvenidaVisible) {
    <div class="px-3 pt-3 sm:pt-2 xl:px-5">
      @if (carreraElegida.id === 'basicas') {
        <p class="text-justify">
          Est√°s viendo las electivas de {{ carreraElegida.nombreCompleto }}. Estas electivas pueden ser cursadas por
          estudiantes de todas las carreras de ingenier√≠a. Pod√©s ver informaci√≥n adicional y consultar las electivas
          espec√≠ficas de tu carrera en la lista desplegable de arriba a la derecha.
        </p>
      }
      @if (carreraElegida.id !== 'basicas') {
        <p class="text-justify">
          Para completar el plan de estudio de
          {{ carreraElegida.nombreCompleto }}, necesit√°s un total de {{ carreraElegida.horasTotales }} cr√©ditos en
          electivas. Pod√©s armar tu plan de cursado de electivas y ver tu total de cr√©ditos marc√°ndolas en la lista de
          abajo. Pulsando en el + pod√©s ver la info completa de cada electiva.
        </p>
      }
      <p class="text-justify">
        Pod√©s filtrar la lista de materias por cuatrimestre usando los botones que est√°n arriba.
      </p>
      <p class="mb-1 block text-justify md:hidden">
        Pod√©s visualizar la calculadora de horas clickeando en el bot√≥n superior izquierdo. Comunicate con nosotros
        clickeando en el bot√≥n de ? a la derecha.
      </p>
      <hr />
      <p class="mb-1 text-justify">
        Desarrollamos esta aplicaci√≥n con
        @if (carreraElegida.id === 'basicas') {
          üíô
        }
        @if (carreraElegida.id === 'civil') {
          üíú
        }
        @if (carreraElegida.id === 'electrica') {
          ‚ù§Ô∏è
        }
        @if (carreraElegida.id === 'industrial') {
          üß°
        }
        @if (carreraElegida.id === 'mecanica') {
          üíö
        }
        @if (carreraElegida.id === 'sistemas') {
          üíõ
        }
        desde las consejeras y los consejeros estudiantiles de METAs, para brindarte una mejor experiencia en tu
        tr√°nsito por la facu.
      </p>
      <h4 id="badge-bienvenida" class="mt-3 mb-3 text-center font-bold">
        <span class="inline-block w-full p-2 mb-2 text-lg rounded" [ngClass]="estilosDeCarrera(carreraElegida.id)">
          {{ mensajeCuatrimestre }}</span
        >
      </h4>
    </div>
  }
</ng-template>

<ng-template #dropdownCarrera>
  <div id="dropdown-carrera" class="relative inline-flex">
    <button
      type="button"
      [ngClass]="estilosDeCarrera(carreraElegida.id)"
      class="rounded-l px-3 py-1 font-bold sm:hidden"
      (click)="verVistaPrincipal()"
    >
      {{ carreraElegida.nombreCorto }}
    </button>
    <button
      type="button"
      [ngClass]="estilosDeCarrera(carreraElegida.id)"
      class="hidden rounded-l px-3 py-1 font-bold sm:inline-block flex-1"
    >
      {{ carreraElegida.nombreCompleto }}
    </button>
    <button
      class="rounded-r border-l border-white/30 px-2 py-1"
      [ngClass]="estilosDeCarrera(carreraElegida.id)"
      (click)="toggleCarreraDropdown()"
    >
      ‚ñº
    </button>
    @if (carreraDropdownOpen) {
      <div class="absolute top-full right-0 z-50 min-w-48 rounded border border-gray-200 bg-white shadow-lg">
        @for (carrera of carreras; track carrera) {
          <div class="flex">
            <span class="w-8 rounded-none" [ngClass]="estilosDeCarrera(carrera.id)">&nbsp;</span>
            <button class="grow px-3 py-1 text-left hover:bg-gray-100" (click)="seleccionarCarrera(carrera.id)">
              {{ carrera.nombreCompleto }}
            </button>
          </div>
        }
      </div>
    }
  </div>
</ng-template>

<ng-template #redesSociales>
  @if (ayudaVisible) {
    <div
      id="redes-sociales"
      class="m-3 rounded-none border border-gray-200 bg-white p-2 shadow md:mx-4 md:mt-3 md:mb-3 lg:mx-auto"
    >
      <h5 class="flex justify-center items-center gap-4 mb-1 text-center text-xl font-bold">
        ¬øTen√©s dudas?
        <img src="https://images.emojiterra.com/google/android-nougat/512px/1f914.png" />
      </h5>
      <p class="text-justify">
        Consult√° a METAs
        {{ carreraElegida.nombreCompleto.split(' ')[carreraElegida.nombreCompleto.split(' ').length - 1] }}
        v√≠a Instagram:
      </p>
      <div class="mb-2 flex justify-center text-center">
        @if (carreraElegida.contacto.instagram) {
          <img
            class="cursor-pointer"
            id="instagram-icon"
            src="assets/img/instagram-icon.png"
            (click)="navegarInstagram()"
          />
        }
        @if (carreraElegida.contacto.whatsapp) {
          <div class="flex-1">
            <img
              class="cursor-pointer"
              id="whatsapp-icon"
              src="assets/img/whatsapp-icon.png"
              (click)="navegarWhatsapp()"
            />
          </div>
        }
      </div>
    </div>
  }
</ng-template>
